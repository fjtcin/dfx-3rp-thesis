\chapter{软件系统实现与集成}

在前两章分别完成系统总体架构设计和可重构硬件模块实现后，本章将聚焦于运行在Xilinx Kria KV260平台处理器系统（PS）上的软件系统实现与集成。
这包括配置嵌入式Linux操作环境以及编写主机端C/C++应用程序。
用户通过 Xilinx 提供的 \verb|xmutil| 命令管理FPGA上的可重构模块（RM），精确地调用和协调FPGA上的硬件加速任务。
应用程序借助 XRT 在 PS 和 PL 间传输数据。

\section{嵌入式Linux环境配置}

本系统采用Xilinx官方提供的Ubuntu Linux，其针对Zynq UltraScale+ MPSoC进行了优化，
并内建了对FPGA可编程逻辑（PL）以及动态功能交换（DFX）的支持。
启动KV260并加载Linux系统后，需进行基础的系统配置，例如网络连接、用户管理，并安装必要的开发工具链，
为主机应用程序编译提供支持。

\section{主机应用程序设计与架构}

主机应用程序采用C/C++语言编写，旨在提供一个用户友好的接口来调用FPGA实现的各种矩阵运算任务。

以稀疏矩阵乘法为例，在运行主机程序前，用户需通过 \verb|xmutil| 命令安装相应RM。
主机应用程序先从本地文件读取矩阵数据，随后启动3个RM（稀疏矩阵解压、稠密矩阵乘法、稀疏矩阵压缩）。
借助XRT，主机程序先分别指定这3个RM的输入输出选择信号：
稀疏矩阵解压的输入为AXIMM接口的DDR内存，输出为AXIS接口连接稠密矩阵乘法的输入；
稠密矩阵乘法的输出为AXIS接口连接稀疏矩阵压缩的输入；稀疏矩阵压缩的输出为AXIMM接口的DDR内存。
随后，主机程序向稀疏矩阵解压RM传输两个稀疏矩阵的数据流，该数据流最终从稀疏矩阵压缩的RM流出，
这便是稀疏矩阵乘法的结果，由主机程序接收后保存至本地文件。
主机程序最后关闭3个RM。用户可通过 \verb|xmutil| 卸载相应RM。
